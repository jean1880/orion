"use strict";angular.module("dogToolApp",["angular-flash.flash-alert-directive","angular-flash.service","angular-jwt","angularMoment","emguo.poller","frapontillo.bootstrap-switch","ngAnimate","ngCookies","ngFileUpload","ngResource","ngRoute","ngSanitize","ngTouch","sticky","truncate","ui.bootstrap","ui.bootstrap.datetimepicker","ui.bootstrap.showErrors","ui.calendar"]).config(["$routeProvider","pollerConfig","flashProvider","jwtInterceptorProvider","$httpProvider",function(a,b,c,d,e){c.successClassnames.push("alert-success"),c.infoClassnames.push("alert-info"),c.warnClassnames.push("alert-warning"),c.errorClassnames.push("alert-danger"),a.when("/",{templateUrl:"views/dog/list.html",controller:"DogListCtrl",title:"Dog"}).when("/working",{template:"<h1>Working...</h1>"}).when("/dogs",{templateUrl:"views/dog/list.html",controller:"DogListCtrl"}).when("/dog/new",{templateUrl:"views/dog/new.html",controller:"DogNewCtrl"}).when("/dog/:id",{templateUrl:"views/dog/view.html",controller:"DogViewCtrl"}).when("/people",{templateUrl:"views/people/list.html",controller:"PeopleListCtrl"}).when("/person/new",{templateUrl:"views/people/new.html",controller:"PeopleNewCtrl"}).when("/person/:id",{templateUrl:"views/people/view.html",controller:"PeopleViewCtrl"}).when("/jobs",{templateUrl:"views/job/job-list.html",controller:"JobsCtrl"}).when("/jobs/day/:date",{templateUrl:"views/job/job-list.html",controller:"JobsCtrl"}).when("/jobs/new",{templateUrl:"views/job/job-new.html",controller:"NewJobsCtrl"}).when("/jobs/new/:startDate/:endDate",{templateUrl:"views/job/job-new.html",controller:"NewJobsCtrl"}).when("/jobs/new/:startDate/:endDate/:allDay",{templateUrl:"views/job/job-new.html",controller:"NewJobsCtrl"}).when("/jobs/:id",{templateUrl:"views/job/job-new.html",controller:"JobsEditCtrl"}).when("/people/new",{templateUrl:"views/people/new.html",controller:"PeopleNewCtrl"}).when("/people/:id",{templateUrl:"views/people/view.html",controller:"PeopleViewCtrl"}).when("/Tester",{templateUrl:"views/tester.html",controller:"TesterCtrl"}).when("/gridTest",{templateUrl:"views/gridtest.html",controller:"GridtestCtrl"}).when("/calendar",{templateUrl:"views/calendar/view.html",controller:"CalendarCtrl"}).when("/quote",{templateUrl:"views/quote.html",controller:"QuoteCtrl"}).when("/homework",{redirectTo:"/homework/new"}).when("/homework/new",{templateUrl:"views/homework.html",controller:"HomeworkNewCtrl"}).when("/homework/:id",{templateUrl:"views/homework.html",controller:"HomeworkCtrl"}).when("/businessInfo",{templateUrl:"views/businessinfo.html",controller:"BusinessinfoCtrl"}).when("/homework/new/:id",{templateUrl:"views/homework.html",controller:"HomeworkNewCtrl"}).when("/library",{templateUrl:"views/homeworkManagement.html",controller:"HomeworkMngCtrl"}).when("/invoice/:id",{templateUrl:"views/invoice.html",controller:"InvoiceCtrl",controllerAs:"invoice"}).when("/quote",{templateUrl:"views/quote.html",controller:"QuoteCtrl"}).otherwise({redirectTo:"/"}),b.stopOnRouteChange=!0,d.authHeader="Token",d.authPrefix="",d.tokenGetter=["FactoryAuthToken",function(a){return a.getToken()}],e.interceptors.push("jwtInterceptor")}]).run(["$location","FactoryLogin","amMoment",function(a,b){var c=a.url();a.url("/working"),b.validate().success(function(d){d.valid?a.url(c):b.login().success(function(){a.url(c)})})}]),angular.module("dogToolApp").constant("SAILS_URL","http://notjustkibble.ca:1337").constant("PASSWORD_CERT","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"),angular.module("dogToolApp").factory("FactoryAddress",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Address.get(c))},getAll:function(){return a.get(b.Address.getAll)},listen:function(){return c.get(b.Address.listen)},post:function(c){return a.post(b.Address.post,c)},find:function(c){return a.post(b.Address.find,c)},update:function(c){return a.put(b.Address.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryAuthToken",["$rootScope","$cookies",function(a,b){var c="user_token";return{setToken:function(d){a.userLoggedIn=!0,b[c]=d},getToken:function(){return b[c]},delToken:function(){a.userLoggedIn=!1,delete b[c]}}}]),angular.module("dogToolApp").factory("FactoryBehaviourFlag",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.BehaviourFlag.get(c))},getAll:function(){return a.get(b.BehaviourFlag.getAll)},listen:function(){return c.get(b.BehaviourFlag.listen)},post:function(c){return a.post(b.BehaviourFlag.post,c)},find:function(c){return a.post(b.BehaviourFlag.find,c)},update:function(c){return a.put(b.BehaviourFlag.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryBusinessInfo",["$http","SailsRoute","poller",function(a,b){return{get:function(){return a.get(b.BusinessInfo.getAll)},update:function(c){return a.put(b.BusinessInfo.getAll,c)}}}]),angular.module("dogToolApp").factory("factoryCalendar",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Calendar.get(c))},getAll:function(){return a.get(b.Calendar.getAll)},listen:function(){return c.get(b.Calendar.listen)},post:function(c){return a.post(b.Calendar.post,c)},find:function(c){return a.post(b.Calendar.find,c)},update:function(c){return a.put(b.Calendar.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryCost",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Cost.get(c))},getAll:function(){return a.get(b.Cost.getAll)},listen:function(){return c.get(b.Cost.listen)},post:function(c){return a.post(b.Cost.post,c)},find:function(c){return a.post(b.Cost.find,c)},update:function(c){return a.put(b.Cost.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryDog",["$http","SailsRoute","SAILS_URL","poller","Upload",function(a,b,c,d,e){return{get:function(c){return a.get(b.Dog.get(c))},getAll:function(){return a.get(b.Dog.getAll)},listen:function(){return d.get(b.Dog.listen)},post:function(c){return a.post(b.Dog.post,c)},find:function(c){return a.post(b.Dog.find,c)},update:function(c){return a.put(b.Dog.update(c.id),c)},upload:function(a,b){return e.upload({url:c+"/Dog/uploadPhoto/"+b.id,file:a[0]})},processDog:function(a){a.Birthdate?(a.Birthdate=new Date(a.Birthdate),a.Age=moment(a.Birthdate).fromNow(!0)):(a.Birthdate=void 0,a.Age=void 0)}}}]),angular.module("dogToolApp").factory("FactoryExpense",["$http","SailsRoute","poller","Upload",function(a,b,c){return{get:function(c){return a.get(b.Expense.get(c))},getAll:function(){return a.get(b.Expense.getAll)},listen:function(){return c.get(b.Expense.listen)},post:function(c){return a.post(b.Expense.post,c)},find:function(c){return a.post(b.Expense.find,c)},update:function(c){return a.put(b.Expense.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryInvoice",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Invoice.get(c))},getAll:function(){return a.get(b.Invoice.getAll)},listen:function(){return c.get(b.Invoice.listen)},post:function(){return a.post(b.Invoice.post,homework)},find:function(c){return a.post(b.Invoice.find,c)},update:function(c){return a.put(b.Invoice.update(c.id),c)},remove:function(c){return a["delete"](b.Invoice["delete"](c))}}}]),angular.module("dogToolApp").factory("FactoryHomework",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Homework.get(c))},getAll:function(){return a.get(b.Homework.getAll)},listen:function(){return c.get(b.Homework.listen)},post:function(c){return a.post(b.Homework.post,c)},find:function(c){return a.post(b.Homework.find,c)},update:function(c){return a.put(b.Homework.update(c.id),c)},remove:function(c){return a["delete"](b.Homework["delete"](c))}}}]),angular.module("dogToolApp").factory("FactoryJob",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Job.get(c))},getAll:function(){return a.get(b.Job.getAll)},listen:function(){return c.get(b.Job.listen)},post:function(c){return a.post(b.Job.post,c)},find:function(c){return a.post(b.Job.find,c)},update:function(c){return a.put(b.Job.update(c.id),c)},"delete":function(c){return a["delete"](b.Job["delete"],c)}}}]),angular.module("dogToolApp").factory("FactoryJobType",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.JobType.get(c))},getAll:function(){return a.get(b.JobType.getAll)},listen:function(){return c.get(b.JobType.listen)},post:function(c){return a.post(b.JobType.post,c)},find:function(c){return a.post(b.JobType.find,c)},update:function(c){return a.put(b.JobType.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryLogin",["$http","SAILS_URL","FactoryAuthToken","PASSWORD_CERT",function(a,b,c,d){var e=b+"/login";return{login:function(){var b={passwordCert:d};return a.post(e,b).success(function(a){c.setToken(a.token)})},validate:function(){var b={token:c.getToken()};return a.post(e+"/validate",b).success(function(a){a.valid||c.delToken()})}}}]),angular.module("dogToolApp").factory("FactoryNote",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Note.get(c))},getAll:function(){return a.get(b.Note.getAll)},listen:function(){return c.get(b.Note.listen)},post:function(c){return a.post(b.Note.post,c)},find:function(c){return a.post(b.Note.find,c)},update:function(c){return a.put(b.Note.update(c.id),c)},destroy:function(c){return a["delete"](b.Note["delete"](c.id))}}}]),angular.module("dogToolApp").factory("FactoryPeople",["SailsRoute","$http","poller",function(a,b,c){return{get:function(c){return b.get(a.People.get(c))},getAll:function(){return b.get(a.People.getAll)},listen:function(){return c.get(a.People.listen)},post:function(c){return b.post(a.People.post,c)},find:function(c){return b.post(a.People.find,c)},update:function(c){return b.put(a.People.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryQuote",["SailsRoute","$http","poller",function(a,b){return{get:function(c){return b.get(a.Quote.get(c))},getAll:function(){return b.get(a.Quote.getAll)},post:function(c){return b.post(a.Quote.post,c)},update:function(c){return b.put(a.Quote.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryService",["SailsRoute","$http","poller",function(a,b){return{get:function(c){return b.get(a.Service.get(c))},getAll:function(){return b.get(a.Service.getAll)},post:function(c){return b.post(a.Service.post,c)},update:function(c){return b.put(a.Service.update(c.id),c)}}}]),angular.module("dogToolApp").factory("FactoryWeight",["$http","SailsRoute","poller",function(a,b,c){return{get:function(c){return a.get(b.Weight.get(c))},getAll:function(){return a.get(b.Weight.getAll)},listen:function(){return c.get(b.Weight.listen)},post:function(c){return a.post(b.Weight.post,c)},find:function(c){return a.post(b.Weight.find,c)},update:function(c){return a.put(b.Weight.update(c.id),c)}}}]),angular.module("dogToolApp").factory("HelperService",function(){return{convert:{objectArrayToIdArray:function(a){var b=a.map(function(a){if("object"==typeof a)return a.id?a.id:a;throw new TypeError("Item is not an object")});return b}}}}),angular.module("dogToolApp").service("SailsRoute",["SAILS_URL",function(a){var b=function(b){return{route:a+"/"+b,getAll:a+"/"+b,listen:a+"/"+b,post:a+"/"+b,find:a+"/"+b+"/find",get:function(a){return this.route+"/"+a},update:function(a){return this.route+"/"+a},"delete":function(a){return this.route+"/"+a}}};return{Dog:b("dog"),Cost:b("cost"),Calendar:b("calendar"),Weight:b("weight"),Daycare:b("daycare"),Note:b("note"),People:b("people"),Homework:b("homework"),Address:b("address"),Consultation:b("consultation"),Job:b("job"),BehaviourFlag:b("behaviourflag"),BusinessInfo:b("businessinfo"),Expense:b("expense"),JobType:b("jobtype"),Service:b("service"),Quote:b("quote"),Invoice:b("invoice")}}]),angular.module("dogToolApp").controller("BusinessinfoCtrl",["$scope","FactoryBusinessInfo","FactoryExpense","flash",function(a,b,c,d){a.Title="Business Information",c.getAll().success(function(b){a.ExpenseInfo=b}),a.addingExpense=!1,a.addExpense=function(){a.newExpense={},a.addingExpense=!0},a.cancelExpense=function(){a.newExpense={},a.addingExpense=!1,a.addExpenseForm.$setUntouched()},a.saveExpense=function(){a.addExpenseForm.$valid&&a.addExpenseForm.$dirty?e(a.newExpense):a.addingExpense=!1,a.addingExpense=!1};var e=function(a){c.post(a).success(f).error(g)},f=function(){c.getAll().success(function(b){a.ExpenseInfo=b}),a.cancelExpense()},g=function(){d.error="An error occured"};b.get().success(function(b){a.BusinessInfo=b}),a.editingInfo=!1,a.editInfo=function(){a.editedInfo=angular.copy(a.BusinessInfo),a.businessInfoForm.$setDirty(!1),a.editingInfo=!0},a.cancelEdit=function(){a.editingInfo=!1},a.saveInfo=function(){a.businessInfoForm.$valid&&a.businessInfoForm.$dirty?h(a.editedInfo):a.editingInfo=!1};var h=function(a){b.update(a).success(i).error(j)},i=function(){a.BusinessInfo=a.editedInfo,a.editingInfo=!1,a.businessInfoForm.$setDirty(!1)},j=function(){d.error="An error occured"}}]),angular.module("dogToolApp").controller("CalendarCtrl",["$scope","$location","$timeout","factoryCalendar","FactoryJob","FactoryNote","$modal","$modalStack",function(a,b,c,d,e,f,g,h){a.hstep=1,a.mstep=15,a.ismeridian=!0,a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.update=function(){var b=new Date;b.setHours(14),b.setMinutes(0),a.mytime=b},a.clear=function(){a.mytime=null},a.calendarData=[],a.eventSources=[a.calendarData],a.addingEvent=!1,a.allDay=!0,a.monthNote={},a.monthTitle=null,a.monthNoteExists=!1,a.NOTE_TYPE="MonthNote";var i=function(a){a.jobId&&b.url("/jobs/"+a.jobId)},j=function(a,b){a.add(12,"h"),k(a,b,!0)},k=function(b,c,d){a.day=b,c.clone?a.endDay=c:(a.endDay=b.clone(),a.endDay.add(1,"h"),a.allDay=!0),a.startTime=a.day.toDate(),a.endTime=a.endDay.toDate();var e={startTime:a.startTime,endTime:a.endTime,allDay:d};h.getTop()||g.open({animation:!0,templateUrl:"selection.html",controller:"ModalInstanceCtrl",scope:a,resolve:{pass:function(){return e}}})};a.AddEvent=function(){var b=a.day.toDate();b.setHours(b.getHours()+4);var c=a.endDay.toDate();c.setHours(c.getHours()+4),d.post({StartDate:b,EndDate:c,Note:{Title:a.title,Content:a.note,NoteType:"event",IsAllDay:a.allDay||!1}}).success(function(){a.calendarData.push({title:a.title,start:a.day.toDate(),end:a.endDay.toDate(),allDay:a.allDay})})};var l=function(a){var b=a.end?a.end.toDate():null,c=a.start.toDate();b||c.setHours(c.getHours()+4),d.update({StartDate:a.start.toDate(),EndDate:b,id:a.id})},m=function(a,b,c,d){var e=!1;"month"==d.type&&(a.add(12,"h"),e=!0),k(a,b,e),$("#calendar").fullCalendar("unselect")},n=function(b){a.monthTitle=b.title,f.find({Title:a.monthTitle,NoteType:a.NOTE_TYPE}).success(function(b){b.length>0?(a.monthNoteExists=!0,a.monthNote=b[0]):(a.monthNoteExists=!1,a.monthNote={})})};a.uiConfig={calendar:{editable:!0,height:"auto",selectable:!0,eventLimit:!0,header:{left:"title",center:"today prev,next",right:"month, agendaWeek, agendaDay"},select:m,eventClick:i,dayClick:j,timezone:"local",eventResize:l,eventDrop:l,viewRender:n}};var o=function(a,b){e.get(a.Jobs[0].id).success(function(c){p(a,b+" - "+c.Jobtype.Name,c.id)})},p=function(b,c,d){var e=b.Colour||"#3a87ad";a.calendarData.push({title:c,start:new Date(b.StartDate),end:new Date(b.EndDate),allDay:b.IsAllDay,color:e,jobId:d,id:b.id,stick:!0})};a.SaveMonthNote=function(){a.monthNote.Title=a.monthTitle,a.monthNote.NoteType=a.NOTE_TYPE,a.monthNoteExists?f.update(a.monthNote).success(function(){flash.success="Note created"}):f.post(a.monthNote).success(function(){flash.success="Note updated"})};var q=function(){d.getAll().success(function(a){for(var b=a.length-1;b>=0;b--){var c,d=!1;a[b].Note?c=a[b].Note.Title:a[b].Jobs&&a[b].Jobs.length>0&&(c=a[b].Jobs[0].Name,d=!0,o(a[b],c)),d||p(a[b],c)}})};q()}]),angular.module("dogToolApp").controller("ModalInstanceCtrl",["$scope","$location","$timeout","$modalInstance","pass","factoryCalendar",function(a,b,c,d,e,f){a.startTime=e.startTime,a.endTime=e.endTime,a.allDay=e.allDay,a.ok=function(){d.close()},a.GotoDay=function(){var c=new Date(a.startTime.valueOf());c.setHours(c.getHours()+4),b.url("/jobs/day/"+encodeURI(c)),d.close()},a.CreateBooking=function(){var c=new Date(a.startTime.valueOf());c.setHours(c.getHours());var e=new Date(a.endTime.valueOf());e.setHours(e.getHours()),console.log(a.allDay),b.url(a.allDay?"/jobs/new/"+encodeURI(c)+"/"+encodeURI(e)+"/"+encodeURI(a.allDay):"/jobs/new/"+encodeURI(c)+"/"+encodeURI(e)),d.close()},a.AddEvent=function(){var b=new Date(a.startTime.valueOf());b.setHours(b.getHours()+4);var c=new Date(a.endTime.valueOf());c.setHours(c.getHours()+4),f.post({StartDate:b,EndDate:c,Note:{Title:a.title,Content:a.note,NoteType:"event",IsAllDay:a.allDay||!1}}).success(function(){a.calendarData.push({title:a.title,start:a.day.toDate(),end:a.endDay.toDate(),allDay:a.allDay}),d.close()})},a.cancel=function(){d.dismiss("cancel")}}]),angular.module("dogToolApp").controller("DogListCtrl",["$scope","$location","FactoryDog","flash",function(a,b,c,d){var e=function(){f()},f=function(){a.dogs=null,c.getAll().success(function(b){a.dogs=b}).error(function(){d.error="A error occured while loading dogs."})};e()}]),angular.module("dogToolApp").controller("DogNewCtrl",["$scope","FactoryDog","flash","$location",function(a,b,c,d){var e=function(){a.saveBtnText="Create",a.dog={}};a.saveBtn=function(){a.dogEditForm.$setSubmitted(!0),f()&&b.post(a.dog).success(function(a){c.success="Dog Created",d.path("/dog/"+a.id)}).error(function(){c.error="Error saving dog"})};var f=function(){return a.dogEditForm.$invalid?!1:g()?!0:!1},g=function(){return a.dog.Owner?!0:!1};e()}]),angular.module("dogToolApp").controller("DogViewCtrl",["$scope","$routeParams","$location","FactoryDog","flash",function(a,b,c,d,e){var f=function(){g(b.id),a.editingInfo=!1,a.editOwner=!1,a.editVet=!1,a.editEmgContact=!1},g=function(b){d.get(b).success(function(b){var c=b;d.processDog(c),a.dog=c}).error(function(a,b){switch(b){case 404:e.error="Dog not found";break;default:e.error="An error occured"}c.path("/")})};a.ownerUpdated=function(a){h("Owner",a)},a.vetUpdated=function(a){h("Vet",a)},a.emgContactUpdated=function(a){h("EmergencyContact",a)},a.updateNotes=function(){var b={id:a.dog.id,Notes:a.dog.Notes};d.update(b).success(function(b){a.dog=b,e.success="Notes saved"}).error(function(){e.error="An error occured while saving notes."})};var h=function(b,c){var f={id:a.dog.id};f[b]=c,d.update(f).success(function(){e.success="Dog updated"}).error(function(){e.error="Error updating dog"})};f()}]),angular.module("dogToolApp").controller("HomeworkNewCtrl",["$scope","$location","FactoryDog","FactoryHomework","flash","$rootScope","HelperService","$window","$routeParams",function(a,b,c,d,e,f,g,h,i){a.hstep=1,a.mstep=10,a.ismeridian=!0,a.addedDogUI=[];var j=function(){k(),a.Homework={Title:"Unnamed",Description:"",Dogs:[],Notes:[],StartDate:new Date,EndDate:new Date,Status:!1},null!=i.id&&d.get(i.id).success(function(b){a.Homework.Title=b.Title,a.Homework.Description=b.Description})};a.addDog=function(b){a.addedDogUI.push(b);var c=a.dogs.indexOf(b);c>-1&&a.dogs.splice(c,1)},a.removeDog=function(b){var c=a.addedDogUI.indexOf(b);a.dogs.push(b),c>-1&&a.addedDogUI.splice(c,1)};var k=function(){a.dogs=null,c.getAll().success(function(b){a.dogs=b}).error(function(){e.error="A error occured while loading dogs."}),f.HomeworkSubmitted?(f.HomeworkSubmitted=!1,f.HomeworkLog={Title:"Unnamed",Description:"",Dogs:[],Notes:[],StartDate:new Date,EndDate:new Date}):a.Homework=f.HomeworkLog};a.submitHomework=function(b){a.submitted=!0,b&&""!=a.Homework.Title&&""!=a.Homework.Description&&(a.Homework.Dogs=g.convert.objectArrayToIdArray(a.addedDogUI),d.post(a.Homework).success(function(a){f.HomeworkSubmitted=!0,e.success="Homework Saved",h.location.href="#/homework/"+a.id}).error(function(){}))},j()}]),angular.module("dogToolApp").controller("HomeworkCtrl",["$scope","$location","FactoryDog","FactoryHomework","flash","$rootScope","HelperService","$routeParams",function(a,b,c,d,e,f,g,h){a.hstep=1,a.mstep=10,a.ismeridian=!0,a.addedDogUI=[];var i=function(){j()};a.addDog=function(b){a.addedDogUI.push(b);var c=a.dogs.indexOf(b);c>-1&&a.dogs.splice(c,1)},a.removeDog=function(b){var c=a.addedDogUI.indexOf(b);a.dogs.push(b),c>-1&&a.addedDogUI.splice(c,1)};var j=function(){a.dogs=null,c.getAll().success(function(b){a.dogs=b,k()}).error(function(){e.error="A error occured while loading dogs."})},k=function(){d.get(h.id).success(function(b){a.Homework=b;var c=g.convert.objectArrayToIdArray(a.dogs);console.log(c),angular.forEach(b.Dogs,function(b){console.log(c.indexOf(b.id),b.id),-1!=c.indexOf(b.id)&&a.addedDogUI.push(a.dogs[c.indexOf(b.id)])}),console.log(b),a.dogs=a.dogs.filter(l),a.Homework.StartDate=new Date(a.Homework.StartDate),a.Homework.EndDate=new Date(a.Homework.EndDate),console.log("status:",a.Homework.Status)}).error(function(){e.error="Sorry we could not access the job in question."})},l=function(b){var c=g.convert.objectArrayToIdArray(a.Homework.Dogs);return-1==c.indexOf(b.id)};a.submitHomework=function(b){a.submitted=!0,console.log("isVald:",b," Lenght",a.addedDogUI.lenght),b&&a.addedDogUI.length>0&&""!=a.Homework.Title&&""!=a.Homework.Description&&(a.Homework.Dogs=g.convert.objectArrayToIdArray(a.addedDogUI),d.update(a.Homework).success(function(){f.HomeworkSubmitted=!0,e.success="Homework Saved"}).error(function(){}))},i()}]),angular.module("dogToolApp").controller("InvoiceCtrl",["$routeParams","FactoryInvoice","FactoryJob","FactoryJobType","FactoryBusinessInfo","flash","$scope","FactoryPeople","$window",function(a,b,c,d,e,f,g,h,i){var j=function(){c.get(a.id).success(function(a){g.bookingData=a,d.getAll().success(function(a){g.jobTypes=a}).error(function(){f.error="An error occured while loading job types."}),h.get(a.Dogs[0].Owner).success(function(a){g.ownerData=a}).error(function(){f.error="There was a problem loading the owner"}),b.get(a.Invoice.id).success(function(a){g.invoiceData=a}).error(function(){f.error="Sorry, there was a problem with loading the invoice"})}).error(function(){f.error="Sorry there was a problem loading the booking information"}),g.invoiceSubTotal,g.invoiceTaxes,g.taxRate=13,g.subtotal=function(){return g.invoiceSubTotal=0,g.invoiceData?(g.invoiceData.Charges.forEach(function(a){g.invoiceSubTotal+=null!=a.JobType?g.bookingData.Jobtype.Value*a.Quantity:a.Value*a.Quantity}),g.invoiceSubTotal):0},g.taxes=function(){return g.invoiceSubTotal*(g.taxRate/100)},g.today=new Date,g.dateDue=new Date,e.get().success(function(a){g.BusinessInfo=a})};g.addCharge=function(){g.invoiceData.Charges.push({Quantity:1,Invoice:g.invoiceData.id,ServiceCustom:"",Value:0}),console.log("New Charge",g.invoiceData.Charges)},g.removeCharge=function(a){g.invoiceData.Charges.splice(a,1),console.log("New Charges Deleted:",g.invoiceData.Charges)},g.saveInvoice=function(){b.update(g.invoiceData).success(function(){f.success="Invoice Saved"}).error(function(){f.error="Sorry, there was a problem with loading the invoice"})},g.printInvoice=function(){i.print()},j()}]),angular.module("dogToolApp").controller("JobsEditCtrl",["$scope","$location","FactoryDog","flash","FactoryJob","FactoryJobType","$routeParams","HelperService","$sce","$q",function(a,b,c,d,e,f,g,h,i){a.pageType="Edit ",a.selectedJobType,a.addedDogUI=[],a.fullAddress=null;var j=new Date;a.booking={Name:"",Dogs:[],Costs:[],Notes:[],Invoice:[],Jobtype:{id:null},Location:{Street:" ",City:" "},Calendars:{StartDate:j,EndDate:j,IsAllDay:!1}},a.submitted=!1;var k=function(){f.getAll().success(function(b){a.jobTypes=b,o()}).error(function(){d.error="An error occured while loading job types."})},l=function(){e.get(g.id).success(function(b){a.booking=b,a.booking.Calendars.EndDate=new Date(a.booking.Calendars.EndDate),a.booking.Calendars.StartDate=new Date(a.booking.Calendars.StartDate),a.isUpdated=!0,a.addedDogUI=b.Dogs,a.dogs=a.dogs.filter(n),a.selectedJobType=b.Jobtype;var c="https://www.google.com/maps/embed/v1/place",d="AIzaSyBVriHiqrpv6aGFnYnFl-pbxThfuPQB3G0",e=[a.booking.Location.Street,a.booking.Location.City,a.booking.Location.Province,a.booking.Location.Country],f=e.join("+").replace(" ","+");a.fullAddress=i.trustAsResourceUrl(c+"?key="+d+"&q="+f)}).error(function(){d.error="An error occured. Unable to load booking information"})},m=function(){k()},n=function(b){var c=h.convert.objectArrayToIdArray(a.booking.Dogs);return-1==c.indexOf(b.id)};a.dateOptions={startingDay:1,showWeeks:!1},a.hourStep=1,a.minuteStep=1,a.timeOptions={hourStep:[1,2,3],minuteStep:[1,5,10,15,25,30]};var o=function(){a.dogs=null,c.getAll().success(function(b){a.dogs=b,l()}).error(function(){d.error="An error occured while loading dogs."})};m(),a.createBooking=function(){a.submitted=!0,a.booking.Dogs.length>0&&(a.selectedJobType&&(a.booking.Jobtype=a.selectedJobType.id),a.booking.Dogs=h.convert.objectArrayToIdArray(a.booking.Dogs),e.update(a.booking).success(function(){d.success="Job Created."}).error(function(){d.error="An error occured while creating a new Job. Sorry but this job was not created."}))},a.bookDog=function(b){var c=a.dogs[b];a.dogs.splice(b,1),a.addedDogUI.push(c)},a.removeDog=function(b){var c=a.addedDogUI[b];a.dogs.push(c),a.addedDogUI.splice(b,1)},a.addFee=function(){if(""!=a.feeDescription&&null!=a.feeAmount){var b={Date:new Date,Description:a.feeDescription,Cost:a.feeAmount};a.booking.Costs.push(b)}else""==a.feeDescription&&(d.error="Please enter a description"),null==a.feeAmount&&(d.error="Please enter a fee amount in proper currency")},a.updateNotes=function(){},a.removeBooking=function(){d.error=a.booking.id,e["delete"](a.booking.id).success(function(){d.error="Worked."}).error(function(){d.error="Failed."})}}]),angular.module("dogToolApp").controller("NewJobsCtrl",["$scope","$location","FactoryDog","flash","FactoryJob","FactoryJobType","$window","$rootScope","HelperService","$routeParams",function(a,b,c,d,e,f,g,h,i,j){a.pageType="Create ",a.selectedJobType,a.addedDogUI=[],a.booking={Name:"",Dogs:[],Costs:[],Notes:[],Invoice:[],Jobtype:{id:null},Location:{Street:" ",City:" "},Calendars:{StartDate:null,EndDate:null,IsAllDay:!1}},a.submitted=!1;var k=function(a,b){return a.setSeconds(0),a.setMinutes(0),b&&a.setHours(a.getHours()+1),a},l=function(){j.startDate&&j.endDate?(a.booking.Calendars.StartDate=new Date(decodeURI(j.startDate)),j.allDay?(a.booking.Calendars.IsAllDay=j.allDay,a.booking.Calendars.EndDate=new Date(decodeURI(j.startDate)),a.booking.Calendars.EndDate.setHours(a.booking.Calendars.StartDate.getHours()+12)):a.booking.Calendars.EndDate=new Date(decodeURI(j.endDate))):(a.booking.Calendars.StartDate=new Date,a.booking.Calendars.EndDate=new Date,a.booking.Calendars.StartDate=k(a.booking.Calendars.StartDate),a.booking.Calendars.EndDate=k(a.booking.Calendars.EndDate,!0))},m=function(){l(),o()},n=function(b){var c=i.convert.objectArrayToIdArray(a.booking.Dogs);return-1==c.indexOf(b.id)};a.dateOptions={startingDay:1,showWeeks:!1},a.ismeridian=!0,a.hourStep=1,a.minuteStep=15;var o=function(){a.dogs=null,c.getAll().success(function(b){a.dogs=b,f.getAll().success(function(b){a.jobTypes=b}).error(function(){d.error="An error occured while loading job types."}),null!=h.bookingLog&&null==h.bookingLog.id?(a.booking=h.bookingLog,l(),a.dogs=a.dogs.filter(n)):(h.bookingLog={},h.bookingLog=a.booking)}).error(function(){d.error="An error occured while loading dogs."})};m(),a.createBooking=function(){a.selectedJobType&&(a.booking.Jobtype.id=a.selectedJobType.id),a.submitted=!0,a.addedDogUI.length>0&&(a.booking.Dogs=i.convert.objectArrayToIdArray(a.addedDogUI),e.post(a.booking).success(function(a){d.success="Job Created.",g.location.href="#/jobs/"+a.id}).error(function(){d.error="An error occured while creating a new Job. Sorry but this job was not created."}))},a.bookDog=function(b){var c=a.dogs.indexOf(b);a.addedDogUI.push(b),a.dogs.splice(c,1)},a.removeDog=function(b){var c=a.addedDogUI.indexOf(b);
a.dogs.push(b),a.addedDogUI.splice(c,1)},a.addFee=function(){if(""!=a.feeDescription&&null!=a.feeAmount){var b={Date:new Date,Description:a.feeDescription,Cost:a.feeAmount};a.booking.Costs.push(b)}else""==a.feeDescription&&(d.error="Please enter a description"),null==a.feeAmount&&(d.error="Please enter a fee amount in proper currency")}}]),angular.module("dogToolApp").controller("JobsCtrl",["$scope","FactoryDog","FactoryJob","$routeParams","factoryCalendar",function(a,b,c,d,e){a.JobList=[];var f=function(d){c.find({Calendars:d}).success(function(c){a.JobList=c;for(var d=c.length-1;d>=0;d--)for(var e=c[d].Dogs.length-1;e>=0;e--)b.get(c[d].Dogs[e].id).success(function(b){for(var c=a.JobList.length-1;c>=0;c--)for(var d=a.JobList[c].Dogs.length-1;d>=0;d--)a.JobList[c].Dogs[d].id==b.id&&(a.JobList[c].Dogs[d]=b)})})},g=function(){var b=new Date(a.date.valueOf());b.setDate(b.getDate()+1),b.setHours(0),b.setMinutes(0);var c=new Date(a.date.valueOf());c.setHours(0),c.setMinutes(0),e.find({StartDate:{"<=":b},EndDate:{">=":c}}).success(function(b){a.events=b;for(var c=[],d=0;d<a.events.length;d++)c.push(a.events[d].id);f(c)})},h=function(){a.date=d.date||new Date,g()};h()}]),angular.module("dogToolApp").controller("HomeworkMngCtrl",["$scope","FactoryHomework","FactoryDog","HelperService","$location","flash",function(a,b,c,d,e,f){var g=function(b){for(var c in b)a.dog[b[c].id]=b[c]},h=function(b){for(var c in b)a.LibraryList[b[c].id]=b[c]};a.edit=function(a){e.url("/homework/"+a)},a.duplicateHomework=function(a){e.url("/homework/new/"+a)},a.deleteHomework=function(c){b.remove(c).success(function(){f.success="Homework Deleted",a.dogHomeworkGroup={},a.dog={},a.LibraryList={},j(),a.$apply()}).error(function(){f.error="Sorry but could not delete the homework"})};var i=function(){a.dogHomeworkGroup={},a.dog={},a.LibraryList={},a.sortBy="dog",j()};a.updateHomework=function(c){b.update(a.LibraryList[c]).success(function(){f.success="Status Saved"}).error(function(){f.error="Sorry there was an issue saving the status change"})};var j=function(){b.getAll().success(function(a){h(a),c.getAll().success(function(a){g(a),k()}).error(function(){f.error="A error occured while loading dogs."})})},k=function(){var b={};for(var c in a.LibraryList)for(var d in a.LibraryList[c].Dogs){var e=a.LibraryList[c].Dogs[d].id;null==b[e]&&(b[e]={homeworkList:[],dogName:a.LibraryList[c].Dogs[d].Name,id:e}),b[e].homeworkList.push(a.LibraryList[c].id)}a.dogHomeworkGroup=[],angular.forEach(b,function(b){a.dogHomeworkGroup.push(b)}),a.homeworkByTitle=[],angular.forEach(a.LibraryList,function(b){a.homeworkByTitle.push(b)})};a.changeSortBy=function(b){a.sortBy=b},i()}]),angular.module("dogToolApp").controller("PeopleNewCtrl",["$scope","FactoryPeople","flash","$location",function(a,b,c,d){var e=function(){a.person={}};a.editFormSubmit=function(){b.post(a.person).success(function(a){c.success="Person created",d.path("/people/"+a.id)}).error(function(){c.error="An error occured"})},e()}]),angular.module("dogToolApp").controller("PeopleListCtrl",["$scope","FactoryPeople","flash",function(a,b,c){var d=function(){e()},e=function(){a.people=null,b.getAll().success(function(b){a.people=b,console.log(b)}).error(function(){c.error="A error occured while loading people."})};a.isOwner=function(b){return b&&a.ownerFlag?b.Dogs.length>0:!0},d()}]),angular.module("dogToolApp").controller("PeopleViewCtrl",["$scope","$location","FactoryPeople","flash","$routeParams","FactoryDog",function(a,b,c,d,e,f){var g=function(){h(e.id)},h=function(e){c.get(e).success(function(b){a.person=b,i(a.person)}).error(function(a,c){switch(c){case 404:d.error="Person not found";break;default:d.error="An error occured"}b.path("/people")})},i=function(a){f.find({Owner:a.id}).success(function(b){a.Dogs=b}).error(function(){d.error="An error occured loading dog info"})};a.editInfoBtn=function(){a.editedPerson={id:a.person.id,Name:a.person.Name,Email:a.person.Email,Phone:a.person.Phone,Address:a.person.Address},a.editingInfo=!0},a.cancelInfoBtn=function(){a.editingInfo=!1},a.updateNotes=function(){c.update(a.person)},a.editInfoSubmit=function(){c.update(a.editedPerson).success(function(b){a.person=b,a.editingInfo=!1}).error(function(){d.error="An error occured"})},g()}]),angular.module("dogToolApp").controller("QuoteCtrl",["$scope","FactoryBusinessInfo","FactoryQuote","FactoryService","flash","$window",function(a,b,c,d,e,f){a.Services={},b.get().success(function(b){a.BusinessInfo=b}),a.Services.Date=new Date,a.addingService=!1,d.getAll().success(function(b){a.ServiceList=b}),a.print=function(){f.print()},a.addService=function(){a.addingService=!0},a.cancelService=function(){a.addingService=!1,a.Services=null,a.AddServiceForm.$setUntouched()},a.saveQuote=function(){a.AddServiceForm.$valid&&a.AddServiceForm.$dirty&&c.post(a.Services).success(function(){e.success="Quote has been Saved!"}).error(function(){e.error="A Problem has Occured"})},a.saveService=function(){a.cancelService()}}]),angular.module("dogToolApp").controller("confirmNoteDeleteModalCtrl",["$scope","$modalInstance","data",function(a,b,c){a.note=c.note,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("dogToolApp").directive("dogCard",function(){return{restrict:"E",scope:{dog:"=",btnText:"=",btnClick:"&",btnType:"="},templateUrl:"views/directives/dog-card.html",controller:["$scope","$location",function(a,b){a.gotoDogPage=function(){b.path("/dog/"+a.dog.id)},a.callButtonCallback=function(b){b.stopPropagation(),a.btnClick()}}]}}),angular.module("dogToolApp").directive("dogEditForm",function(){return{restrict:"E",scope:{formCtrl:"=",dog:"="},templateUrl:"views/dog/edit-form.html",link:function(a){a.formCtrl=a.form},controller:["$scope","FactoryBehaviourFlag",function(a,b){var c=function(){b.getAll().success(function(b){a.behaviourFlags=b}),a.$watch("dog",function(){a.dog&&d(a.dog)})},d=function(a){a.Gender||(a.Gender="Unknown"),a.SpayedNeutered||(a.SpayedNeutered="Unknown"),a.OnTiters||(a.OnTiters="Unknown"),a.BehaviourFlag||(a.BehaviourFlag=null)};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},c()}]}}),angular.module("dogToolApp").directive("dogInfoPanel",function(){return{restrict:"E",scope:{dog:"="},templateUrl:"views/directives/dog-info-panel.html",link:function(a){a.labels={SpayedNeutered:"Neutered"}},controller:["$scope","FactoryDog","flash",function(a,b,c){a.$watch("dog",function(){a.dog&&(a.dog.SpayedNeutered||(a.dog.SpayedNeutered="Unknown"),a.dog.Deceased||(a.dog.Deceased=!1),"Male"===a.dog.Gender?a.labels.SpayedNeutered="Neutered":"Female"===a.dog.Gender&&(a.labels.SpayedNeutered="Spayed"))}),a.editInfoBtn=function(){a.editingInfo=!0,a.dog.BehaviourFlag||(a.dog.BehaviourFlag={id:null}),a.editedDog={id:a.dog.id,Name:a.dog.Name,Breed:a.dog.Breed,Birthdate:a.dog.Birthdate,Gender:a.dog.Gender,SpayedNeutered:a.dog.SpayedNeutered,OnTiters:a.dog.OnTiters,Deceased:a.dog.Deceased,BehaviourFlag:a.dog.BehaviourFlag.id,photoURL:a.dog.photoURL},a.infoForm.$setDirty(!1)},a.saveInfoBtn=function(){a.infoForm.$valid&&(a.infoForm.$dirty?d(a.editedDog):a.editingInfo=!1)},a.cancelInfoBtn=function(){a.editingInfo=!1},a.upload=function(c){c.length>0&&b.upload(c,a.dog).progress(function(a){parseInt(100*a.loaded/a.total)}).success(function(b){a.dog.photoURL=b.photoURL})};var d=function(a){b.update(a).success(e).error(f)},e=function(c){b.processDog(c),a.dog=c,a.editingInfo=!1,a.infoForm.$setDirty(!1)},f=function(){c.error="An error occured"}}]}}),angular.module("dogToolApp").directive("notesPanel",function(){return{restrict:"E",scope:{notes:"=",defaultTypes:"=",onNotesChanged:"&",showSaveBtn:"=?",panelTitle:"=",panelType:"="},templateUrl:"views/directives/notes-panel.html",link:function(a,b,c){angular.isDefined(c.showSaveBtn)||(a.showSaveBtn=!0)},controller:["$scope","FactoryNote","flash","$modal",function(a,b,c,d){a.tabs=[],a.$watch("notes",function(){a.notes&&(a.tabs.forEach(function(a){a.notes=[]}),a.notes.forEach(function(b){var c=g(b.NoteType);null===c&&(c={name:b.NoteType,notes:[]},a.tabs.push(c)),c.notes.push(b)}))}),a.$watch("defaultTypes",function(){a.defaultTypes&&a.defaultTypes.forEach(function(b){var c=g(b);null===c&&(c={name:b,notes:[]},a.tabs.push(c))})}),a.saveAllNotes=function(){async.map(a.notes,e,function(b,c){a.notes=c,a.onNotesChanged()})},a.saveNoteOnBlur=function(a){if(a.Title&&a.Content){console.log("blurred");var c;c=a.id?b.update(a):b.post(a),c.success(function(){}).error(function(){})}};var e=function(a,c){var d;d=a.id?b.update(a):b.post(a),d.success(function(a){c(null,a)}).error(function(a){c(a)})};a.comfirmDelete=function(a){var b=d.open({templateUrl:"views/modals/confirm-note-delete.html",controller:"confirmNoteDeleteModalCtrl",size:"sm",animation:!0,resolve:{data:function(){return{note:a}}}});b.result.then(function(){f(a)})};var f=function(d){var e=a.notes.indexOf(d);b.destroy(d).success(function(){a.notes.splice(e,1);var b=g(d.NoteType),c=b.notes.indexOf(d);b.notes.splice(c,1),a.onNotesChanged()}).error(function(){c.error="An error occured while deleteing the Note"})};a.addNote=function(d){var e={Title:"New Note",Content:"",NoteType:d.name};b.post(e).success(function(b){a.notes.push(b),d.notes.push(b),a.onNotesChanged()}).error(function(){c.error="An error occured while creating a Note"})};var g=function(b){var c=null;return a.tabs.forEach(function(a){null===c&&a.name===b&&(c=a)}),c}}]}}),angular.module("dogToolApp").directive("personEditForm",function(){return{restrict:"E",scope:{person:"=",formSubmit:"="},templateUrl:"views/directives/person-edit-form.html",controller:"PersonEditFormCtrl"}}),angular.module("dogToolApp").directive("personInfo",function(){return{restrict:"E",scope:{person:"=",hideName:"@"},templateUrl:"views/directives/person-info.html",controller:"PersonInfoCtrl"}}),angular.module("dogToolApp").directive("personPanel",function(){return{restrict:"E",scope:{panelTitle:"@",panelType:"@",person:"=",personUpdated:"=?",unlinkable:"=?"},link:function(a){a.unlinkable=angular.isDefined(a.unlinkable)?a.unlinkable:!0},templateUrl:"views/directives/person-panel.html",controller:"PersonPanelCtrl"}}),angular.module("dogToolApp").directive("personSelectCreate",function(){return{restrict:"E",scope:{name:"@",selectedId:"@",personIdChanged:"="},templateUrl:"views/directives/person-select-create.html",controller:"PersonSelectCreateCtrl"}}),angular.module("dogToolApp").directive("weightList",function(){return{templateUrl:"views/directives/weight-list.html",restrict:"E",scope:{dog:"="},controller:"WeightListCtrl"}}),angular.module("dogToolApp").directive("dogImage",["SAILS_URL","$log",function(a,b){return{restrict:"A",scope:{dog:"=dogImage"},link:function(c,d,e){c.$watch("dog.photoURL",function(){c.dog&&(b.info(c.dog.photoURL),c.dog.photoURL?e.$set("src",a+c.dog.photoURL):e.$set("src","/images/no-dog-image.jpg"))})}}}]),angular.module("dogToolApp").controller("PersonEditFormCtrl",["$scope","FactoryAddress",function(a,b){var c=function(){a.$watch("person",function(a){a&&d(a)})},d=function(a){"string"==typeof a.Address&&b.get(a.Address).success(function(b){a.Address=b})};a.editFormSubmit=function(){a.editForm.$valid&&a.formSubmit&&a.formSubmit()},c()}]),angular.module("dogToolApp").controller("PersonInfoCtrl",["$scope","FactoryAddress",function(a,b){var c=function(){a.$watch("person",function(a){a&&d(a)})},d=function(a){"string"==typeof a.Address&&b.get(a.Address).success(function(b){a.Address=b})};c()}]),angular.module("dogToolApp").controller("PersonPanelCtrl",["$scope","FactoryPeople",function(a,b){var c=function(){a.editMode=!1};a.enableEditMode=function(){a.editMode=!0},a.disableEditMode=function(){a.editMode=!1,a.$broadcast("editMode.disabled")},a.unlinkPerson=function(){a.unlinkable&&(a.person=null,d(null))},a.personIdChanged=function(c){b.get(c).success(function(b){a.person=b,a.disableEditMode(),d(c)})};var d=function(b){a.personUpdated&&a.personUpdated(b)};c()}]),angular.module("dogToolApp").controller("PersonSelectCreateCtrl",["$scope","FactoryPeople","flash",function(a,b,c){var d=function(){f(),g(),a.$on("editMode.disabled",f)};a.selectFormSubmit=function(){a.selectForm.$valid&&e()},a.createFormSubmit=function(){b.post(a.newPerson).success(function(b){a.people.push(b),a.selectedId=b.id,a.newPerson={},e()}).error(function(){c.error="An error occured"})};var e=function(){a.personIdChanged&&a.personIdChanged(a.selectedId)},f=function(){a.mode="",a.selectForm&&(a.selectForm.$setPristine(!0),a.selectForm.$setUntouched(!0)),a.createForm&&(a.createForm.$setPristine(!0),a.createForm.$setUntouched(!0))},g=function(){b.getAll().success(function(b){a.people=b})};d()}]),angular.module("dogToolApp").controller("WeightListCtrl",["$scope","FactoryWeight",function(a,b){var c=function(){a.weightFormSubmitted=d,a.convertDateTakenToDate=e,a.countPerPage=5,a.page=1},d=function(){a.weightForm.$valid&&(a.processing=!0,g(a.newWeight),b.post(a.newWeight).success(f).error(h)["finally"](i))},e=function(a){return new Date(a.DateTaken)},f=function(b){a.dog.Weights.push(b),j()},g=function(b){b.DateTaken=new Date,b.Dog=a.dog.id},h=function(b){var c=a.weightForm;if(c.$invalid=!0,c.$dirty=!0,c.$submitted=!0,b.invalidAttributes)for(var d in b.invalidAttributes){c[d].$invalid=!0;var e=b.invalidAttributes[d].map(function(a){return a.rule});-1!==e.indexOf("required")?c[d].$error.required=!0:-1!==e.indexOf("float")&&(c[d].$error.number=!0)}},i=function(){a.processing=!1},j=function(){a.processing=!1,a.weightForm.$submitted=!1,a.weightForm.$dirty=!1,a.newWeight={Weight:null,DateTaken:null,Dog:null}};c()}]),angular.module("dogToolApp").filter("truncateFilter",function(){return function(a,b,c){if(isNaN(b)&&(b=10),void 0===c&&(c="..."),a){var d=a.split(/\s+/);d.length>b&&(a=d.slice(0,b).join(" ")+"...")}return a}});